{% extends 'layout.html' %}
<!-- <div class="carts" style="padding-top: 200px;">

<form action="/payment" method="POST">
  {% for carts in cart %}

  <div class="cart">
    <input type="hidden" name="capname" value="{{'carts.capname'}}">{{carts.capname}}
  
   
   <input type="hidden" name="capnumber" value="{{carts.capnumber}}">{{carts.capnumber}}
   <div class="cart-brand" name="brand" value="{{carts.brand}}" >{{carts.brand}}</div>
    <div class="cap-content">{{cart.content}}</div>
    <input type="hidden" name="price" value="{{carts.price +'원'}}">{{carts.price +'원'}}
    <input type="hidden" name="img" value="{{cap.img}}">{{carts.img}}
    <div class="cap-img"><img src="{{cap.img}}" alt="섬네일">
      {% endfor %}
    <button class="twit-follow" type="submit" class="btn" >결제하기</button>

      

    </form> -->


{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400&family=Noto+Serif+KR:wght@300&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Sunflower:wght@300&display=swap');

.shoppingCart-section {
    background-color: rgba(0,0,0,0);
    margin: 0 auto;
    width: 950px;
    min-width: 700px;
    padding-bottom: 30px;
    font-family: 'Noto Sans KR', sans-serif;
}

.shoppingCart-items-table tr:first-child td, .shoppingCart-items-table tr:nth-child(2) td{
    height: 10px;
    padding: 10px;
}

.shoppingCart-items-table tr:first-child{
    border: 1px solid rgba(0,0,0,0.2);
    background-color: rgba(0,0,0,0.03);
}

.shoppingCart-item-img img {
    height: 100%;
}

.shoppingCart-item a {
    display:inline-block;
    height: 15px;
    padding-bottom:30px;
}

.shoppingCart-items-table {
    border-collapse:collapse;
    border-spacing:0;
}
.shoppingCart-items-table tr {
    border-top: 1px solid rgba(0,0,0,0.2);
    border-bottom: 1px solid rgba(0,0,0,0.2);
}
.shoppingCart-items-table  tr:last-child{
    border-top: 1px solid rgba(0,0,0,0.2);
    border-bottom: 1px solid rgba(0,0,0,0.2);
    background-color:rgba(0,0,0,0.03);
}
.shoppingCart-items-table tr:last-child td{
    height: 30px;
    padding: 20px;
}

.shoppingCart-items-table td {
    height: 100px;
}
.shoppingCart-items-table td button{
    display:block;
}
.shoppingCart-items-table {
    width:100%;
}

.buy-all{
    float:right;
    cursor:pointer;
    color: white;
    border: 2px solid tan;
    background-color: rosybrown;
    border:none;
    height: 30px;
    width: 80px;
    margin-top:20px;
}

.buy-item, .delete-item{
    cursor:pointer;
    color: white;
    border: 2px solid tan;
    background-color: rosybrown;
    border:none;
    height: 25px;
    width: 50px;
    margin-bottom:3px;
}

.shoppingCart-header {
    width: 100%;
    text-align:center;
    margin-bottom: 30px;
}

.shoppingCart-header > h3 {
    font-family: 'Sunflower', sans-serif;
    background-color: white;
    border-bottom: 3px solid rgb(230, 214, 197);
    color: rgb(59, 57, 57);
    display: inline-block;
    font-size: 25px;
}

.input-container {
    border: 1px solid black;
}
</style>
<form action="/payment" method="POST">
<section class="shoppingCart-section" style="padding-top: 200px;">
    <div class=shoppingCart-header>
        <h3> Shopping Cart </h3>
    </div>
    <div class="shoppingCart-items">
        <table class="shoppingCart-items-table">
            <tr>
                <td>
                    일반 상품
                </td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>
                    <a>이미지</a>
                </td>
                <td>
                    <a>상품 이름</a>
                </td>
                <td>
                    <a>가격</a>
                </td>
                <td></td>
            </tr>
            {% set totalPrice = 0 %}
            {% for carts in cart%}
            {% set totalPrice = totalPrice + carts.price %}
            <tr>
                <td class="shoppingCart-item-img">
                    <img src="{{carts.img}}" />
                </td>
                <td>
                    <a class="item-name">{{carts.capname}}</a>
                </td>
                <td>
                    <a class="item-price">￦{{carts.price}}</a>
                </td>
                <td>
                    <button class="buy-item" value="{{carts.pid}}">구매</button>
                    <button class="delete-item">삭제</button>
                </td>
            </tr>
            {% endfor %}
            <tr>
                <td>[ 기본 배송 ]</td>
                <td style="text-align:right">
                    <a>총액</a>
                </td>
                <td>
                    
                    <a class="item-price-all">￦{{totalPrice}}</a>
                </td>
                <td></td>
            </tr>
        </table>
        <input type="hidden" name="price" value="{{totalPrice}}">
        <button class="buy-all">모두 구매</button>
    </div>
</section>
</form>

<div>
    <form id="comment-form">
      <fieldset>
        <legend>댓글 등록</legend>
        <div><input id="userid" type="text" placeholder="사용자 아이디"></div>
        <div><input id="comment" type="text" placeholder="댓글"></div>
        <button type="submit">등록</button>
      </fieldset>
    </form>
  </div>
  <br>
  <table id="comment-list">
    <thead>
    <tr>
      <th>아이디</th>
      <th>작성자</th>
      <th>댓글</th>
      <th>수정</th>
      <th>삭제</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
 async function getComment(id) {
    try {
      const res = await axios.get(`/users/${id}/comments`);
      const comments = res.data;
      const tbody = document.querySelector('#comment-list tbody');
      tbody.innerHTML = '';
      comments.map(function (comment) {
        // 로우 셀 추가
        const row = document.createElement('tr');
        let td = document.createElement('td');
        td.textContent = comment.id;
        row.appendChild(td);
        td = document.createElement('td');
        td.textContent = comment.User.name;
        row.appendChild(td);
        td = document.createElement('td');
        td.textContent = comment.comment;
        row.appendChild(td);
        const edit = document.createElement('button');
        edit.textContent = '수정';
        edit.addEventListener('click', async () => { // 수정 클릭 시
          const newComment = prompt('바꿀 내용을 입력하세요');
          if (!newComment) {
            return alert('내용을 반드시 입력하셔야 합니다');
          }
          try {
            await axios.patch(`/comments/${comment.id}`, { comment: newComment });
            getComment(id);
          } catch (err) {
            console.error(err);
          }
        });
        const remove = document.createElement('button');
        remove.textContent = '삭제';
        remove.addEventListener('click', async () => { // 삭제 클릭 시
          try {
            await axios.delete(`/comments/${comment.id}`);
            getComment(id);
          } catch (err) {
            console.error(err);
          }
        });
        // 버튼 추가
        td = document.createElement('td');
        td.appendChild(edit);
        row.appendChild(td);
        td = document.createElement('td');
        td.appendChild(remove);
        row.appendChild(td);
        tbody.appendChild(row);
      });
    } catch (err) {
      console.error(err);
    }
  }


  document.getElementById('comment-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const id = e.target.userid.value;
    const comment = e.target.comment.value;
    if (!id) {
      return alert('아이디를 입력하세요');
    }
    if (!comment) {
      return alert('댓글을 입력하세요');
    }
    try {
      await axios.post('/comments', { id, comment });
      getComment(id);
    } catch (err) {
      console.error(err);
    }
    e.target.userid.value = '';
    e.target.comment.value = '';
  });



</script>
{% endblock %}
